project:
  execute-dir: project
  type: website
  output-dir: _site
  render:
    - index.qmd
    - overview.qmd
    - quality.qmd
    - methods.qmd
    - glossary.qmd
    - about.qmd
    - by-province/index.qmd
    - by-condition/index.qmd
    - by-trending/index.qmd
    - by-forecasts/index.qmd
    - explorer/index.qmd
    - burden-of-disease/index.qmd
  #pre-render: Rscript R/prepare_dashboard_data.r

website:
  title: "SA NMC Dashboard"
  search:
    location: navbar
    type: overlay
  navbar:
    background: primary
    left:
      - text: Home
        href: index.html
        icon: house-door
      - text: Overview
        href: overview.html
        icon: bar-chart-line
      - text: Surveillance
        icon: clipboard2-pulse
        menu:
          - text: "By Province — Overview"
            href: by-province/index.html
          - text: "---"
          - text: "Eastern Cape"
            href: by-province/ec/index.html
          - text: "Free State"
            href: by-province/fs/index.html
          - text: "Gauteng"
            href: by-province/gp/index.html
          - text: "KwaZulu-Natal"
            href: by-province/kzn/index.html
          - text: "Limpopo"
            href: by-province/lp/index.html
          - text: "Mpumalanga"
            href: by-province/mp/index.html
          - text: "Northern Cape"
            href: by-province/nc/index.html
          - text: "North West"
            href: by-province/nw/index.html
          - text: "Western Cape"
            href: by-province/wc/index.html
          - text: "---"
          - text: "By Condition"
            href: by-condition/index.html
      - text: Analytics
        icon: graph-up-arrow
        menu:
          - text: "Trending & Signals"
            href: by-trending/index.html
          - text: "Burden of Disease"
            href: burden-of-disease/index.html
          - text: "Forecasts & Scenarios"
            href: by-forecasts/index.html
      - text: Explorer
        href: explorer/index.html
        icon: search
      - text: Data Quality
        href: quality.html
        icon: clipboard-check
    right:
      - text: Docs
        icon: book
        menu:
          - text: "Methods"
            href: methods.html
          - text: "Glossary"
            href: glossary.html
          - text: "---"
          - text: "About & Credits"
            href: about.html
  sidebar:
    - id: surveillance
      title: "Surveillance"
      style: floating
      collapse-level: 2
      contents:
        - section: "By Province"
          contents:
            - by-province/index.qmd
            - text: "Eastern Cape"
              href: by-province/ec/index.html
            - text: "Free State"
              href: by-province/fs/index.html
            - text: "Gauteng"
              href: by-province/gp/index.html
            - text: "KwaZulu-Natal"
              href: by-province/kzn/index.html
            - text: "Limpopo"
              href: by-province/lp/index.html
            - text: "Mpumalanga"
              href: by-province/mp/index.html
            - text: "Northern Cape"
              href: by-province/nc/index.html
            - text: "North West"
              href: by-province/nw/index.html
            - text: "Western Cape"
              href: by-province/wc/index.html
        - section: "By Condition"
          contents:
            - by-condition/index.qmd
    - id: analytics
      title: "Analytics"
      style: floating
      contents:
        - by-trending/index.qmd
        - burden-of-disease/index.qmd
        - by-forecasts/index.qmd
    - id: docs
      title: "Documentation"
      style: floating
      contents:
        - methods.qmd
        - glossary.qmd
        - about.qmd
  page-footer:
    left: "Data sources: NMC, Stats SA  ·  Last update: {{< meta last_update >}}"
    center: "SA NMC Epidemiological Intelligence Dashboard"
    right: "[Methods](methods.html) · [Glossary](glossary.html) · [About](about.html)"
    border: true
    background: light

format:
  html:
    theme:
      light: cosmo
    css: styles.css
    toc: true
    df-print: paged
    code-tools: false
    echo: false
    smooth-scroll: true
    link-external-newwindow: true

execute:
  echo: false
  cache: true
  # Preamble loads shared utilities for pages that still use them (e.g. index.qmd).
  # Dashboard pages (overview, by-province, etc.) load their own data from
  # data/processed/*.rds so do NOT depend on this preamble.
  preamble: |
    message(">> preamble ran")
    suppressPackageStartupMessages({
      library(yaml)
      library(glue)
      library(dplyr)
      library(tidyr)
    })
    vars <- yaml::read_yaml("_variables.yml")
    # Heavy sources (aggregator, tabulate) are loaded only when the objects
    # they create are actually needed by legacy pages.
    if (file.exists("R/aggregator_national.r")) {
      tryCatch(source("R/aggregator_national.r"), error = function(e) message("aggregator skipped: ", e$message))
    }
    if (file.exists("R/tabulate_functions.r")) {
      tryCatch(source("R/tabulate_functions.r"), error = function(e) message("tabulate skipped: ", e$message))
    }

metadata-files:
  - _variables.yml