---
title: "SA NMC Dashboard"
subtitle: "Epidemiological Intelligence for Notifiable Medical Conditions"
page-layout: full
toc: false
format:
  html:
    anchor-sections: false
---

::: {.hero-intro}
## Welcome

This dashboard makes **Notifiable Medical Conditions (NMC)** data accessible and actionable for public health officials across South Africa. It provides timely insights into disease trends, hotspots, and forecasts to support effective decision-making and resource allocation.

All coding and analysis is open-source — any epidemiologist can reproduce the work locally and contribute improvements.
:::

## Dashboard Sections {.unlisted}

::: {.section-grid}

::: {.section-card}
#### [National Overview](overview.html)
<span class="badge-descriptive">DESCRIPTIVE</span> <span class="status-dev"></span> In development

High-level surveillance snapshot — total cases, top conditions, national epicurve and key indicators.
:::

::: {.section-card}
#### [By Province](by-province/index.html)
<span class="badge-descriptive">DESCRIPTIVE</span> <span class="status-active"></span> Active

Provincial summaries with case counts, incidence rates, interactive charts and district drilldown. Includes sub-pages for all 9 provinces.
:::

::: {.section-card}
#### [By Condition](by-condition/index.html)
<span class="badge-descriptive">DESCRIPTIVE</span> <span class="status-active"></span> Active

Condition-centric view: national epicurves, provincial comparisons, district hotspot tables with export.
:::

::: {.section-card}
#### [Trending & Signals](by-trending/index.html)
<span class="badge-analytical">ANALYTICAL</span> <span class="status-dev"></span> In development

Signal detection (CUSUM/EARS) for emerging conditions, surge tables, trend sparklines and alert log.
:::

::: {.section-card}
#### [Burden of Disease](burden-of-disease/index.html)
<span class="badge-analytical">ANALYTICAL</span> <span class="status-planned"></span> Planned

Years of Life Lost (YLL), DALYs and age-standardised rates to quantify health impact beyond case counts.
:::

::: {.section-card}
#### [Forecasts & Scenarios](by-forecasts/index.html)
<span class="badge-predictive">PREDICTIVE</span> <span class="status-dev"></span> In development

Short-term EpiNow2 forecasts (1–6 weeks), scenario bands, nowcasting with reporting-delay adjustment.
:::

::: {.section-card}
#### [Data Explorer](explorer/index.html)
<span class="badge-interactive">INTERACTIVE</span> <span class="status-planned"></span> Planned

Self-service tool: select conditions, dates and locations, then visualise epicurves, maps, statistics and download data.
:::

::: {.section-card}
#### [Data Quality](quality.html)
<span class="badge-quality">QUALITY</span> <span class="status-dev"></span> In development

Reporting completeness by province, submission volume heatmaps, timeliness metrics and validation checks.
:::

:::

---

## Documentation {.unlisted}

::: {.section-grid}

::: {.section-card}
#### [Methods](methods.html)
Data sources, indicator formulas, signal detection algorithms, forecasting methodology and QC procedures.
:::

::: {.section-card}
#### [Glossary](glossary.html)
Abbreviations, epidemiological terms and indicator definitions used throughout the dashboard.
:::

::: {.section-card}
#### [About & Credits](about.html)
Project background, partner organisations, software stack and contribution guidelines.
:::

:::

---

## Planned Architecture

The planned structure of the dashboard is as follows:
```{mermaid}
flowchart TD
    %% ---------- MAIN LAYERS ----------
    A["Home: NMC Epidemiology SA"]


    %% Descriptive
    B["By Province"]
    B1["Province Overview of all conditions"]
    B2["District Drilldown"]
    C["By Condition"]
    C1["National Trends"]
    C2["Province Comparison of condition X"]
    C3["District Hotspots of condition X"]

    %% Interactive
    G["Explorer"]
    G1["Interactive Condition, Date & Location Selector"]
    G2["Epicurve Visualisation"]
    G3["Map Visualisation"]
    G4["Descriptive Statistics"]
    G5["Data Table view and download"]

    %% Analytical
    D["Burden of Disease"]
    D1["YLL — life tables & from vital status"]
    D2["DALYs — YLL + YLD"]
    D3["ASR — age-standardised rates"]

     %%
    E["Trending Conditions"]
    E1["Signal Detection (CUSUM/EARS)"]
    E2["Hotspots (province→district)"]
    E3["Analyst Notes & Alert Log"]


    %% Predictive
    F["Forecasts and scenarios"]
    F1["Short-term forecasts (1–6 wks)"]
    F2["Scenario bands & seasonality"]
    F3["Nowcasting (delay adjustment)"]

    %% ---------- FLOW ----------
    A --> B --> B1 --> B2
    A --> C --> C1 --> C2 --> C3
    A --> D --> D1 --> D2 --> D3
    A --> G --> G1 --> G2 --> G3 --> G4 --> G5
    A --> E --> E1 --> E2 --> E3
    E --> F --> F1 --> F2 --> F3

    %% ---------- CLASSES ----------
    classDef Descriptive fill:#e6f2ff,stroke:#1d4ed8,stroke-width:1.5px,color:#0b2e78;
    classDef Interactive fill:#e0f7fa,stroke:#00796b,stroke-width:1.5px,color:#004d40;
    classDef Analytical fill:#fff4e5,stroke:#b45309,stroke-width:1.5px,color:#7a3b07;
    classDef Predictive fill:#f3e8ff,stroke:#7e22ce,stroke-width:1.5px,color:#42136a;
    classDef LegendBox fill:#f8fafc,stroke:#94a3b8,color:#334155;

    class B,B1,B2,C,C1,C2,C3, Descriptive;
    class G,G1,G2,G3,G4,G5 Interactive;
    class D,D1,D2,D3,E,E1,E2,E3 Analytical;
    class F,F1,F2,F3 Predictive;

    %% ---------- LEGEND ----------
    subgraph LEG["Legend"]
      direction TB
      L1["Descriptive"]:::Descriptive
      L2["Interactive"]:::Interactive
      L3["Analytical"]:::Analytical
      L4["Predictive"]:::Predictive
    end

    class LEG LegendBox;

    %% ---------- OPTIONAL STYLING ----------
    style A stroke:#0b3a75,stroke-width:2px,fill:#eef2ff,rx:8,ry:8
    style LEG rx:6,ry:6

```



```{r}
#| label: nmc-checklist-flextable
#| echo: false
#| message: false
#| warning: false




suppressPackageStartupMessages({
library(tidyverse)
library(lubridate)
library(flextable)
})



today <- Sys.Date()
tasks <- tribble(
~id, ~category, ~task, ~description, ~owner, ~due_date, ~status, ~notes,
1, "Project Setup", "Define scope & architecture", "Finalize site structure (Province/Condition/BoD/Trending/Forecasts)", "", today + 8, "Not started", "",
2, "Project Setup", "Finalize hosting plan", "Choose GitHub Pages / Netlify / Posit Connect", "", today + 9, "Not started", "",
3, "Project Setup", "Create _quarto.yml", "Navbar, theme, lightbox, mermaid config", "", today + 10, "In progress", "",
4, "Data Integration", "Data source mapping", "Map NMC, lab, MYPE, sentinel feeds", "", today + 13, "Not started", "Include canonical district dictionary",
5, "Data Integration", "ETL scripts", "R scripts for cleaning/QC/aggregation", "", today + 17, "Not started", "",
6, "Data Integration", "Validation checks", "Completeness, timeliness, duplicates", "", today + 20, "Not started", "",
7, "Descriptive", "By Province page", "Provincial summary, district drilldown, maps", "", today + 24, "In progress", "Basic dashboard structure implemented",
8, "Descriptive", "By Condition page", "Tabset + dropdown selector", "", today + 27, "In progress", "Basic dashboard structure implemented",
9, "Descriptive", "Click-to-zoom maps", "Leaflet/Plotly + lightbox", "", today + 29, "Not started", "",
10, "Analytical", "Burden of Disease", "Compute YLL, DALY, ASR; document assumptions", "", today + 35, "Not started", "",
11, "Analytical", "Trending detection", "CUSUM/EARS; hotspots table/map", "", today + 39, "Not started", "",
12, "Analytical", "Validate signals", "Test false positives; analyst triage", "", today + 41, "Not started", "",
13, "Predictive", "Forecast models", "ARIMA/Prophet/BSTS with 50–95% CI", "", today + 45, "Not started", "",
14, "Predictive", "Nowcasting", "Delay-adjusted counts integrated with signals", "", today + 47, "Not started", "",
15, "Predictive", "Exports/subscriptions", "CSV/PDF; (optional) email hooks later", "", today + 50, "Not started", "",
16, "Design", "Site-wide CSS", "Consistent fonts/spacing/palette", "", today + 51, "Not started", "",
17, "Design", "Mermaid diagrams", "Styled descriptive/analytical/predictive + SVG", "", today + 6, "Done", "Exported SVG + lightbox",
18, "Docs", "Methods page", "Data sources, calculations, QC", "", today + 53, "Not started", "",
19, "Docs", "Glossary page", "Indicators & abbreviations", "", today + 55, "Not started", "",
20, "Docs", "About/Credits", "D4H, SAMRC, NDoH, Africa CDC", "", today + 56, "Not started", "",
21, "Deploy", "Internal review", "CRDM & MRC review of outputs", "", today + 75, "Not started", "",
22, "Deploy", "External deployment", "Publish to host (Pages/Connect)", "", today + 80, "Not started", "",
23, "Deploy", "Maintenance plan", "Data refresh + rebuild workflow", "", today + 85, "Not started", ""
) |>
mutate(
due_date = as.Date(due_date),
status = factor(status, levels = c("Not started", "In progress", "Blocked", "Done")),
days_remaining = as.integer(difftime(due_date, Sys.Date(), units = "days")),
overdue = !is.na(due_date) & due_date < Sys.Date() & status != "Done"
)

status_palette <- c(
"Not started" = "#334155", # slate-700 text
"In progress" = "#7a3b07", # amber-900 text
"Blocked" = "#991b1b", # red-800 text
"Done" = "#065f46" # emerald-800 text
)




df_show <- tasks %>%
transmute(
  ID = id,
  Category = category,
  Task = task,
  Description = description,
  Owner = owner,
  'Due Date' = due_date,
  'Days Remaining' = days_remaining,
  Status = as.character(status),
  Notes = notes,
  .overdue = overdue # keep for styling
)




ft <- flextable(df_show) |>
set_header_labels(
Description = "Description",
'Due Date' = "Due Date",
'Days Remaining' = "Days Remaining",
Status = "Status"
) |>
autofit() |>
align(j = c("Days Remaining"), align = "right", part = "body") |>

#Status text color



color(i = ~ Status == "Not started", j = "Status", color = status_palette["Not started"]) |>
color(i = ~ Status == "In progress", j = "Status", color = status_palette["In progress"]) |>
color(i = ~ Status == "Blocked", j = "Status", color = status_palette["Blocked"]) |>
color(i = ~ Status == "Done", j = "Status", color = status_palette["Done"]) |>

#Overdue row background (if not done)



#bg(i = ~ .overdue, bg = "#fde2e2") |>
#Days remaining color bins

color(i = ~ `Days Remaining` <= 0, j = "Days Remaining", color = "#b91c1c") |>
color(i = ~ `Days Remaining` > 0 & `Days Remaining` <= 7, j = "Days Remaining", color = "#b45309") |>
color(i = ~ `Days Remaining` > 7, j = "Days Remaining", color = "#065f46") |>
fontsize(part = "all", size = 9) |>
height(part = "header", height = 0.4) |>
height(part = "body", height = 0.35) |>
border_remove() |>
hline_top(part = "header") |>
hline(i = 1, part = "header") |>
hline_bottom(part = "body") |>
autofit()




ft
```